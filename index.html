<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>만나 캐처: 광야의 식탁</title>
    <link rel="stylesheet" href="css/style.css">
    <script type="module" src="js/leaderboard.js"></script>
</head>

<body>

    <div id="game-container">
        <div class="desert-dunes"></div>
        <div id="time-overlay"></div>
        <div id="blindness-overlay"></div>

        <canvas id="gameCanvas"></canvas>

        <!-- 상단 UI -->
        <div id="ui-layer">
            <div style="display:flex; flex-direction:column;">
                <div class="currency-badge">🍞 <span id="manna-display">0</span></div>
                <div class="currency-badge">🪙 <span id="shekel-display">0</span></div>
            </div>
            <div class="control-group" style="display:flex; gap:10px; align-items:flex-start;">
                <div id="life-board" style="padding-top:5px; font-size:24px;">❤️❤️❤️</div>
                <div id="mute-btn" class="icon-btn" onclick="toggleMute()">🔊</div>
                <div id="pause-btn" class="icon-btn" onclick="togglePause()">⏸️</div>
            </div>
        </div>

        <div id="center-indicator">제 1일: 새벽 (만나 거두기)</div>

        <!-- 시작 화면 -->
        <div id="start-screen" class="screen">
            <img id="title-img" src="assets/images/main_title.png" alt="만나 캐처 메인 타이틀">
            <p>매일의 양식을 거두고<br>하루하루 믿음으로 살아가요.</p>

            <div class="main-btn-container">
                <button class="btn" onclick="startGame()" style="font-size: 28px; padding: 20px;">
                    <span>📜</span> 여정 시작
                </button>
                <div class="sub-btn-row">
                    <button class="btn btn-secondary" onclick="openCollection()"><span>🧺</span> 성경 인물</button>
                    <button class="btn btn-green" onclick="openRanking()"><span>🏆</span> 랭킹</button>
                </div>
            </div>

            <p style="font-size: 14px; margin-top: 20px; color: #ccc;">🖱️ PC: 화살표 / 👆 모바일: 터치</p>
        </div>

        <!-- 로딩 화면 -->
        <div id="loading-screen" class="screen">
            <div class="main-title">로딩 중...</div>
            <p>광야의 양식을 준비하고 있습니다.</p>
            <div
                style="width: 200px; height: 10px; background: rgba(255,255,255,0.2); border-radius: 5px; overflow: hidden;">
                <div id="loading-bar" style="width: 0%; height: 100%; background: #f1c40f; transition: width 0.3s;">
                </div>
            </div>
        </div>

        <!-- 일시정지 메뉴 -->
        <div id="pause-screen" class="screen hidden" style="background: rgba(0,0,0,0.7); z-index: 50;">
            <div class="shop-container" style="width: 85%; border-color: #3498db; text-align: center;">
                <h2 style="color:#3498db; margin-top:0; text-shadow:none;">일시 정지</h2>
                <p style="margin-bottom:20px; font-size: 20px; color:#555; text-shadow:none;">잠시 멈춰 묵상합니다.</p>
                <div style="display:flex; flex-direction:column; align-items:center;">
                    <button class="btn btn-green" onclick="togglePause()">계속하기</button>
                    <button class="btn btn-red" onclick="quitGame()">저장하고 나가기</button>
                </div>
            </div>
        </div>

        <!-- 제 6일 알림 팝업 -->
        <div id="day6-modal" class="screen hidden" style="background: rgba(0,0,0,0.85); z-index: 60;">
            <h1 style="color:#f1c40f;">✨ 제 6일의 축복 ✨</h1>
            <p style="font-size:20px; color:white;">오늘은 안식일 예비일입니다!<br>하나님께서 갑절의 은혜를 주시는 날이에요.</p>
            <p style="font-size:18px; color:#e67e22; font-weight:bold;">만나와 메추라기가 2배로 쏟아집니다!</p>
            <button class="btn" onclick="confirmDay6()">아멘! 시작하기</button>
        </div>

        <!-- 제 7일 안식일 화면 (이미지 표시) -->
        <div id="sabbath-screen" class="screen hidden" style="background: rgba(0,0,0,0.9); z-index: 60;">
            <h1 style="color:#f1c40f; margin-bottom: 10px;">✨ 안식일 ✨</h1>
            <p style="font-size:20px; color:white; margin-bottom: 20px;">주 안에서 참된 쉼을 누리세요.</p>
            <!-- [수정] 확장자를 png로 변경 -->
            <img src="assets/images/sevenday.png" alt="안식일 쉼"
                style="max-width: 90%; max-height: 60vh; border-radius: 15px; box-shadow: 0 0 20px rgba(255,255,255,0.2);">
        </div>

        <!-- 광야의 텐트 -->
        <div id="camp-screen" class="screen hidden">
            <h1 style="color:#8e44ad; text-shadow:none;">🌙 광야의 텐트</h1>
            <p style="font-size:18px; color:#eee;">오늘 하루도 지켜주셔서 감사합니다.<br>내일을 위해 정비하고 쉬세요.</p>

            <div class="shop-container">
                <div style="text-align:right; margin-bottom:15px; color:#d35400; font-weight:bold; font-size:18px;">
                    보유 만나: <span id="shop-manna-balance">0</span> 오멜
                </div>

                <div class="shop-item">
                    <div>
                        <span style="font-size:24px;">❤️</span> <b style="font-size:18px;">생명 회복</b>
                        <div style="font-size:14px; color:#666; margin-top:4px;">현재 최대 생명력까지만 회복합니다.</div>
                    </div>
                    <button class="btn btn-small btn-green" onclick="buyItem('life')">30 오멜</button>
                </div>

                <div class="shop-item">
                    <div>
                        <span style="font-size:24px;">🛡️</span> <b style="font-size:18px;">믿음의 방패</b>
                        <div style="font-size:14px; color:#666; margin-top:4px;">내일 첫 공격을 막아줍니다</div>
                    </div>
                    <button class="btn btn-small btn-secondary" onclick="buyItem('shield')">50 오멜</button>
                </div>
            </div>

            <button class="btn btn-purple" style="margin-top:25px;" onclick="nextDay()">잠들기</button>
        </div>

        <!-- 컬렉션(성경 인물) 화면 -->
        <div id="collection-screen" class="screen hidden" style="background: rgba(0,0,0,0.85); z-index: 50;">
            <div class="shop-container"
                style="border-color: #f1c40f; height: 80%; display: flex; flex-direction: column;">
                <h2 style="color:#f39c12; text-shadow:none;">성경 인물 도감</h2>
                <div style="text-align:center; margin-bottom:15px;">
                    <span class="currency-badge" style="font-size:20px;">🪙 보유 세겔: <span
                            id="collection-shekel">0</span></span>
                </div>
                <div id="char-list" class="char-grid"></div>
                <div style="text-align:center; margin-top:15px;">
                    <button class="btn btn-small btn-secondary" style="padding:10px 30px; font-size:18px;"
                        onclick="closeScreens()">닫기</button>
                </div>
            </div>
        </div>

        <!-- 랭킹 화면 -->
        <div id="ranking-screen" class="screen hidden" style="background: rgba(0,0,0,0.85); z-index: 50;">
            <div class="shop-container" style="border-color: #27ae60;">
                <h2 style="color:#27ae60; text-shadow:none;">🏆 명예의 전당</h2>
                <p style="font-size:16px; color:#666; text-shadow:none;">가장 오래 생존한 기록</p>
                <ul id="rank-list"></ul>
                <div style="text-align:center; margin-top:20px;">
                    <button class="btn btn-small btn-secondary" style="padding:10px 30px; font-size:18px;"
                        onclick="closeScreens()">닫기</button>
                </div>
            </div>
        </div>

        <!-- 게임 오버 -->
        <div id="gameover-screen" class="screen hidden">
            <h1>여정 종료</h1>
            <p id="final-day-display" style="font-size:24px; color:#fff; text-shadow:1px 1px 2px #000;">제 1일차에서 잠들다</p>

            <div
                style="background:#f9f9f9; padding:25px; border-radius:15px; margin-bottom:20px; width:85%; border:1px solid #ddd; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">
                <div style="display:flex; justify-content:space-between; font-size:20px; margin-bottom:10px;">
                    <span style="color:#333;">최종 점수:</span> <span id="final-score"
                        style="font-weight:bold; color:#27ae60;">0</span>
                </div>
                <div style="display:flex; justify-content:space-between; font-size:20px;">
                    <span style="color:#333;">획득 세겔:</span> <span id="final-shekel"
                        style="font-weight:bold; color:#f39c12;">0</span>
                </div>
            </div>

            <div style="display:flex; flex-direction:column; align-items:center; width:100%; gap: 10px;">
                <button class="btn" onclick="startGame()">다시 시작</button>
                <button class="btn btn-gray" onclick="location.reload()">메인으로</button>
            </div>
        </div>

        <!-- 말씀 타이핑 모달 -->
        <div id="typing-modal" class="screen hidden">
            <div class="scroll-paper">
                <h3 style="margin-top:0; color:#d35400; text-shadow:none;">📜 말씀 두루마리</h3>
                <!-- [수정] 안내 문구 변경 -->
                <p style="font-size:16px; margin-bottom:15px;">아래 말씀을 띄어쓰기까지 똑같이 입력하세요!</p>
                <p style="font-size:18px; color:#27ae60; font-weight:bold;">✨ 성공 시 보상: 믿음의 방패 또는 최대 생명력 증가 (랜덤)</p>
                <div id="verse-text"></div>
                <div id="verse-ref"></div>
                <input type="text" id="typing-input" placeholder="여기에 입력하세요..." autocomplete="off">
                <div id="input-feedback"></div>
            </div>
        </div>

        <!-- 이름 입력 모달 -->
        <div id="name-input-modal" class="screen hidden" style="background: rgba(0,0,0,0.85); z-index: 200;">
            <div class="shop-container" style="border-color: #27ae60; text-align: center;">
                <h2 style="color:#27ae60; text-shadow:none;">🏆 랭킹 등록</h2>
                <p style="font-size:16px; color:#555; margin-bottom: 20px;">당신의 여정을 기록하세요!</p>

                <input type="text" id="player-name-input" placeholder="이름을 입력하세요"
                    style="font-size:20px; padding:10px; width:80%; margin-bottom:20px; text-align:center; border:2px solid #ddd; border-radius:10px;">

                <button class="btn btn-green" onclick="submitPlayerScore()">기록 남기기</button>
            </div>
        </div>

        <audio id="bgm" src="assets/audio/bgm.mp3" loop></audio>
        <audio id="sfx-collect" src="assets/audio/collect.mp3"></audio>
        <audio id="sfx-hit" src="assets/audio/hit.mp3"></audio>
        <audio id="sfx-success" src="assets/audio/success.mp3"></audio>
        <audio id="sfx-gameover" src="assets/audio/gameover.mp3"></audio>

        <div class="touch-guide" id="touch-guide" class="hidden">화면 왼쪽/오른쪽을 눌러 이동하세요</div>
    </div>

    <script src="js/game.js"></script>
</body>

</html>